<?xml version="1.0" encoding="UTF-8"?>
<definitions xmlns="http://www.omg.org/spec/BPMN/20100524/MODEL"
             xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
             xmlns:xsd="http://www.w3.org/2001/XMLSchema"
             xmlns:camunda="http://camunda.org/schema/1.0/bpmn"
             xmlns:bpmndi="http://www.omg.org/spec/BPMN/20100524/DI"
             xmlns:dc="http://www.omg.org/spec/DD/20100524/DC"
             xmlns:di="http://www.omg.org/spec/DD/20100524/DI"
             id="Definitions_1" targetNamespace="http://bpmn.io/schema/bpmn">

  <process id="StockReplenishmentWorkflow" isExecutable="true" name="Stock Management Process">
    
    <!-- ====================== Lanes ====================== -->
    <laneSet>
      <lane id="Lane_DataAnalysis" name="Data &amp; Analytics"/>
      <lane id="Lane_Merchandising" name="Merchandising"/>
      <lane id="Lane_Finance" name="Finance &amp; Accounting"/>
      <lane id="Lane_Logistics" name="Logistics &amp; Procurement"/>
      <lane id="Lane_IT" name="IT"/>
    </laneSet>

    <!-- Start Event -->
    <startEvent id="StartEvent_1" name="Product out of stock detected">
      <outgoing>Flow_Start</outgoing>
    </startEvent>

    <!-- 2. Data & Analytics -->
    <task id="Task_ComputeQuantity" name="Compute Optimal Replenishment Quantity&#10;(sales history, safety stock, lead times, forecasts)" lane="Lane_DataAnalysis">
      <incoming>Flow_Start</incoming>
      <outgoing>Flow_ToMerch</outgoing>
    </task>

    <!-- 3. Merchandising -->
    <task id="Task_CreateRequest" name="Create Replenishment Request&#10;(using recommended quantity)" lane="Lane_Merchandising">
      <incoming>Flow_ToMerch</incoming>
      <outgoing>Flow_Verify</outgoing>
    </task>

    <task id="Task_VerifyStock" name="Verify Stock&#10;(confirm level below threshold / physical check)" lane="Lane_Merchandising">
      <incoming>Flow_Verify</incoming>
      <outgoing>Flow_ToStockGateway</outgoing>
    </task>

    <exclusiveGateway id="Gateway_StockOK" name="Stock OK?">
      <incoming>Flow_ToStockGateway</incoming>
      <outgoing>Flow_StockYes</outgoing>
      <outgoing>Flow_StockNo</outgoing>
    </exclusiveGateway>

    <endEvent id="End_VerificationFailed" name="Verification failed – process terminated">
      <incoming>Flow_StockNo</incoming>
    </endEvent>

    <!-- 4. Finance & Accounting -->
    <task id="Task_FinanceAnalyze" name="Analyze Replenishment Request&#10;(budget, unit cost, MOQ, feasibility)" lane="Lane_Finance">
      <incoming>Flow_StockYes</incoming>
      <outgoing>Flow_ToFinanceGateway</outgoing>
    </task>

    <exclusiveGateway id="Gateway_FinanceApproved" name="Approved?">
      <incoming>Flow_ToFinanceGateway</incoming>
      <outgoing>Flow_FinanceYes</outgoing>
      <outgoing>Flow_FinanceNo</outgoing>
    </exclusiveGateway>

    <endEvent id="End_FinanceRefused" name="Replenishment refused">
      <incoming>Flow_FinanceNo</incoming>
    </endEvent>

    <!-- 5–6. Logistics & Procurement + Reception/Return -->
    <task id="Task_LogisticsProcess" name="Process Replenishment Request&#10;(supplier selection, PO issuance, shipping)" lane="Lane_Logistics">
      <incoming>Flow_FinanceYes</incoming>
      <outgoing>Flow_ToDeliveryCheck</outgoing>
    </task>

    <task id="Task_CheckDelivery" name="Receive &amp; Check Supplier Delivery&#10;(conformity / quality check)" lane="Lane_Logistics">
      <incoming>Flow_ToDeliveryCheck</incoming>
      <outgoing>Flow_ToDeliveryGateway</outgoing>
    </task>

    <exclusiveGateway id="Gateway_DeliveryOK" name="Delivery conforming?">
      <incoming>Flow_ToDeliveryGateway</incoming>
      <outgoing>Flow_DeliveryYes</outgoing>
      <outgoing>Flow_DeliveryNo</outgoing>
    </exclusiveGateway>

    <task id="Task_HandleReturn" name="Process Return&#10;(non-conforming goods, quality issues)" lane="Lane_Logistics">
      <incoming>Flow_DeliveryNo</incoming>
      <outgoing>Flow_ToReturnEnd</outgoing>
    </task>

    <endEvent id="End_ReturnCompleted" name="Non-compliant delivery returned">
      <incoming>Flow_ToReturnEnd</incoming>
    </endEvent>

    <!-- 7. IT -->
    <task id="Task_ITUpdate" name="Update Stock in Systems&#10;(ERP, WMS, POS synchronization)" lane="Lane_IT">
      <incoming>Flow_DeliveryYes</incoming>
      <outgoing>Flow_ToSuccess</outgoing>
    </task>

    <endEvent id="End_Success" name="Stock successfully replenished">
      <incoming>Flow_ToSuccess</incoming>
    </endEvent>

    <!-- Sequence Flows -->
    <sequenceFlow id="Flow_Start" sourceRef="StartEvent_1" targetRef="Task_ComputeQuantity"/>
    <sequenceFlow id="Flow_ToMerch" sourceRef="Task_ComputeQuantity" targetRef="Task_CreateRequest"/>
    <sequenceFlow id="Flow_Verify" sourceRef="Task_CreateRequest" targetRef="Task_VerifyStock"/>
    <sequenceFlow id="Flow_ToStockGateway" sourceRef="Task_VerifyStock" targetRef="Gateway_StockOK"/>

    <sequenceFlow id="Flow_StockYes" name="Yes" sourceRef="Gateway_StockOK" targetRef="Task_FinanceAnalyze"/>
    <sequenceFlow id="Flow_StockNo" name="No" sourceRef="Gateway_StockOK" targetRef="End_VerificationFailed"/>

    <sequenceFlow id="Flow_ToFinanceGateway" sourceRef="Task_FinanceAnalyze" targetRef="Gateway_FinanceApproved"/>

    <sequenceFlow id="Flow_FinanceYes" name="Yes" sourceRef="Gateway_FinanceApproved" targetRef="Task_LogisticsProcess"/>
    <sequenceFlow id="Flow_FinanceNo" name="No" sourceRef="Gateway_FinanceApproved" targetRef="End_FinanceRefused"/>

    <sequenceFlow id="Flow_ToDeliveryCheck" sourceRef="Task_LogisticsProcess" targetRef="Task_CheckDelivery"/>
    <sequenceFlow id="Flow_ToDeliveryGateway" sourceRef="Task_CheckDelivery" targetRef="Gateway_DeliveryOK"/>

    <sequenceFlow id="Flow_DeliveryYes" name="Yes" sourceRef="Gateway_DeliveryOK" targetRef="Task_ITUpdate"/>
    <sequenceFlow id="Flow_DeliveryNo" name="No" sourceRef="Gateway_DeliveryOK" targetRef="Task_HandleReturn"/>

    <sequenceFlow id="Flow_ToSuccess" sourceRef="Task_ITUpdate" targetRef="End_Success"/>
    <sequenceFlow id="Flow_ToReturnEnd" sourceRef="Task_HandleReturn" targetRef="End_ReturnCompleted"/>
  </process>

  <bpmndi:BPMNDiagram id="BPMNDiagram_1">
    <bpmndi:BPMNPlane id="BPMNPlane_1" bpmnElement="StockReplenishmentWorkflow">
      <!-- Layout is auto-generated by most tools on import -->
    </bpmndi:BPMNPlane>
  </bpmndi:BPMNDiagram>
</definitions>